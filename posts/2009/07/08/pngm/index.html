<!DOCTYPE html>
<html lang="ru">
<head>
	<title>Белый фон — Блог Конфуция</title>
	<!--# include virtual="/inc/common-head.html" -->
</head>
<body>
<!--# include virtual="/inc/common-top.html" -->
<div class="main-wrapper">

<a href="/" class="blog-name">Блог Конфуция</a>

<div class="post">
	<section>
		<h class="title">Белый фон</h>
		<span class="date">08.07.2009</span>
		<section class="content">
		<p>Нужна была консольная утилита добавляющая в png-файл поле с белым цветом фона по умолчанию (bKGD chunk). Было это нужно, чтобы при распечатке коктейлей в IE6 не было противного серого фона (AlphaImageLoader при печати не пашет). Изобретать велосипед не хотелось, поэтому нашел <a href="http://www.codeproject.com/KB/cs/PngUtil.aspx">статью</a>, где чувак подробно рассказывает, как добавить подобную функциональность в программу на C#. Самое полезное там — это объяснение того, что чанк с цветом фона можно добавить прямо перед первым чанком с данными. Но у него все на микрософтовском сишарпе, а мы-то сидим на маках с линуксами. Погуглив еще минутку, нашел и остальное. Все, что связано с PNG, как ни странно, вполне доступно изложено на W3C: и про <a href="http://www.w3.org/TR/PNG/#11bKGD">фон</a>, и про <a href="http://www.w3.org/TR/PNG/#5DataRep">формат</a> вообще.</p>

<p>Поколдовав немного, получил очень прямолинейную программу, выполняющую только одно действие: задание белого, и только белого фона. Выложил <a href="http://github.com/kung-fu-tzu/pngm">на гитхаб</a>, так как планирую добавить возможность хотя бы задавать цвет :)</p>

<p><strong>UPD</strong> (02.12.2009): если обработать один файл дважды, то туда попадут два чанка с бекграундом, от этого картинка сломается в IE. Все дело в этих байтах: <em>00000006624B474400FF00FF00FFA0BDA793</em>, сотрите их и все будет норм :) А еще утилитка <code><a href="http://www.imagemagick.org/script/composite.php">composite</a></code> (из <a href="http://www.imagemagick.org/">ImageMagick</a>) добавляет свой чанк с бекграундом — будте осторожны, не сломайте картинки (как сломал я)!</p>
		</section>
	</section>
	
	<dl class="tags">
		<dt class="head">Теги:</dt>
		<dd class="body">
			<ul class="list"><li class="tag">сервер</li><li class="tag">C</li><li class="tag">composite</li><li class="tag">IE</li><li class="tag">imagemagick</li><li class="tag">png</li></ul>
		</dd>
	</dl>
	
	<div class="comments">Очень жду ваших комментариев <a href="mailto:Комментарии блога Конфуция <comments@kung-fu-tzu.ru>?subject=Re: Белый фон">на почту</a>.</div>
</div>

</div>
<!--# include virtual="/inc/common-bottom.html" -->
</body>
</html>