<!DOCTYPE html>
<html lang="ru">
<head>
	<title>Дырявая песочница — Блог Конфуция</title>
	<!--# include virtual="/inc/common-head.html" -->
</head>
<body>
<!--# include virtual="/inc/common-top.html" -->
<div class="main-wrapper">

<a href="/" class="blog-name">Блог Конфуция</a>

<div class="post">
	<section>
		<h class="title">Дырявая песочница</h>
		<span class="date">09.04.2009</span>
		<section class="content">
		<p>SpiderMonkey, который не перестает удивлять, давно умеет запускать произвольный код изолированно от остального мира, внутри так называемых песочниц. Эта возможность завораживает своей простотой и удобством. Например, можно по-честному разделить свое большое приложение на ядро и модули. Или, если сойти с ума, разрешить контент-менеджерам писать простенький код в шаблонах. Можно даже чужой код загрузить издалека и запускать, но это уже чересчур.</p>

<p>Добиться такой изоляции несложно. Достаточно вызвать <code>evalcx()</code>, передав первым параметром код, который нужно выполнить под присмотром. Функция вернет результат выполнения, как обычный <code>eval()</code>. Такой способ подходит, если созданное в результате окружение нас не интересует. Можно, конечно, вернуть из кода глобальный объект и возиться уже с ним. Но это не наш метод.</p>

<p>Для того, чтобы создать изолированное пространство имен, нужно вызвать <code>evalcx()</code> с пустой строкой в качестве первого параметра: <code>evalcx("")</code>. Так мы получим полностью независимое окружение со своим набором глобальных переменных и классов. Полученный таким хитрым способом объект нужно передавать вторым параметром в <code>evalcx()</code>, а впоследствии использовать повторно или с пользой проанализировать.</p>

<p>Если выполнить <code>evalcx('String.abc = 123', {})</code>, то код сможет изменить наш объект String (или любой другой), а этого делать не следует.</p>

<p>Штука хитрая и полезная, но, конечно, не панацея. Так что использовать для запуска чего-то чужого не рекомендую.</p>
		</section>
	</section>
	
	<dl class="tags">
		<dt class="head">Теги:</dt>
		<dd class="body">
			<ul class="list"><li class="tag">сервер</li><li class="tag">sandbox</li><li class="tag">spidermonkey</li></ul>
		</dd>
	</dl>
	
	<div class="comments">Очень жду ваших комментариев <a href="mailto:Комментарии блога Конфуция <comments@kung-fu-tzu.ru>?subject=Re: Дырявая песочница">на почту</a>.</div>
</div>

</div>
<!--# include virtual="/inc/common-bottom.html" -->
</body>
</html>